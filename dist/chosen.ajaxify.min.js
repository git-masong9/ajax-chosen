!function(e){e.fn.bindWithDelay=function(n,t,o,a,s){return e.isFunction(t)&&(s=a,a=o,o=t,t=void 0),o.guid=o.guid||e.guid&&e.guid++,this.each(function(){var c=250;function u(){var n=e.extend(!0,{},arguments[0]),t=this,u=function(){c=null,o.apply(t,[n])};s||(clearTimeout(c),c=null),c||(c=setTimeout(u,a))}u.guid=o.guid,e(this).bind(n,t,u)})}}(jQuery);var REQUEST={};function chosen_ajaxify(e,n,t="GET",o){var a=e;$(`div#${a=a.split("-").join("_")}_chosen`).hasClass("chosen-container-single")?$(`div#${a}_chosen  .chosen-search input`).bindWithDelay("keyup",function(o){if(o.keyCode>=37&&o.keyCode<=40||13==o.keyCode)return null;null!=REQUEST[e]&&REQUEST[e].abort();var s=$(`div#${a}_chosen .chosen-search input`).val(),c=RegExp(s,"gi");$(`div#${a}_chosen ul.chosen-results`).empty(),$(`#${e}`).empty(),REQUEST[e]=$.ajax({url:n,dataType:"json",type:t,data:{keyword:s},success:function(n){$(`#${e}`).append('<option value=""></option>'),$.map(n,function(n){$(`#${e}`).append(`<option value="${n.value}">${n.caption}</option>`)})},complete:function(){s=$("div#"+a+"_chosen .chosen-search input").val(),$(`#${e}`).trigger("chosen:updated"),$(`div#${a}_chosen`).removeClass("chosen-container-single-nosearch"),$(`div#${a}_chosen .chosen-search input`).val(s),$(`div#${a}_chosen .chosen-search input`).removeAttr("readonly"),$(`div#${a}_chosen .chosen-search input`).focus(),$(`div#${a}_chosen .active-result`).each(function(){var e=$(this).html();$(this).html(e.replace(c,function(e){return`<em>${e}</em>`}))})}},500)}):$("div#"+a+"_chosen").hasClass("chosen-container-multi")&&$("div#"+a+"_chosen input").bindWithDelay("keyup",function(o){if(o.keyCode>=37&&o.keyCode<=40||13==o.keyCode)return null;null!=REQUEST[e]&&REQUEST[e].abort();var s=$("div#"+a+"_chosen input").css("width"),c=$(this).val(),u=RegExp(c,"gi"),h=[],l=[];$(`#${e} option:selected`).each(function(){old_value=$(this).val(),old_caption=$(this).html(),h.push(old_value),l.push(old_caption)}),$(`div#${a}_chosen ul.chosen-results`).empty(),$(`#${e}`).empty(),console.log(h.length),REQUEST[e]=$.ajax({url:n,dataType:"json",type:t,data:{keyword:c},success:function(n){for(i=0;i<h.length;i++)value=h[i],caption=l[i],$(`#${e}`).append(`'<option selected value="${value}">${caption}</option>'`);$.map(n,function(n){h.includes(n.value)||$(`#${e}`).append(`<option value="${n.value}">${n.caption}</option>`)})},complete:function(n){c=$(`div#${a}_chosen input`).val(),$(`#${e}`).trigger("chosen:updated"),$(`div#${a}_chosen`).removeClass("chosen-container-single-nosearch"),$(`div#${a}_chosen input`).val(c),$(`div#${a}_chosen input`).removeAttr("readonly"),$(`div#${a}_chosen input`).css("width",s),$(`div#${a}_chosen input`).focus(),$(`div#${a}_chosen .active-result`).each(function(){var e=$(this).html();$(this).html(e.replace(u,function(e){return`<em>${e}</em>`}))})}})},500)}function chosen_depend_on(e,n,t,o="GET"){var a=$(`${n}`).val();$(`${n}`).change(function(n){var s=$(this).val();s!=a&&$.ajax({url:t,dataType:"json",type:o,data:{keyword:s},success:function(n){$(`#${e}`).empty(),$.map(n,function(n){$(`#${e}`).append(`<option value="${n.value}">${n.caption}</option>`)}),$(`#${e}`).trigger("chosen:updated"),$(`#${e}`).trigger("change")}})})}function ajaxChosenDepend(e,n,t,o="",a="GET"){if(""==o)var s={allow_single_deselect:!0,width:"200px",search_contains:!0};else var s=o;$("#city_select").chosen(s),chosen_depend_on(e,n,t,REQ_TYPE=a)}function ajaxChosen(e,n,t={},o=[],a="GET"){if(""==t)var s={allow_single_deselect:!0,width:"200px",search_contains:!0};else var s=t;$(`#${e}`).chosen(s),chosen_ajaxify(e,n,a),o.length>0&&($(`div#${e}_chosen ul.chosen-results`).empty(),$(`#${e}`).empty(),$.ajax({url:n,dataType:"json",type:a,data:{keyword:o,default:!0},success:function(n){$(`#${e}`).empty(),$.map(n,function(n){$(`#${e}`).append(`<option selected value="${n.value}">${n.caption}</option>`)}),$(`#${e}`).trigger("chosen:updated"),$(`#${e}`).trigger("change")}}))}